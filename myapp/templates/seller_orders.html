{% load static %}

<link rel="stylesheet" href="{% static 'styles/seller_orders.css' %}">
<div class="seller-dashboard">
    <!-- üå∏ Sidebar Menu -->
    <aside class="sidebar">
        <ul class="menu">
            <li class="menu-header">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</li>
            <li class="menu-item"><a href="{% url 'seller_dashboard' %}">üìã ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</a></li>
            <li class="menu-item"><a href="{% url 'my_products' %}">üìã ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a></li>
            <li class="menu-item"><a href="{% url 'add_product' %}">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</a></li>
            <li class="menu-item"><a href="{% url 'edit_store' %}">‚öôÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</a></li>
            <li class="menu-item"><a href="{% url 'edit_seller_profile' %}">‚öôÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢</a></li>
            <li class="menu-item active"><a href="{% url 'seller_orders' %}">üì¶ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a></li>
            <li class="menu-item logout"><a href="{% url 'seller_logout' %}">üö™ Logout</a></li>
        </ul>
    </aside>

    <!-- üå∏ Main Content -->
    <main class="order-management-container">
        <h1>üì¶ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>

        <table class="order-table">
            <thead>
                <tr>
                    <th>üìå Order ID</th>
                    <th>üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                    <th>üí≥ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</th>
                    <th>üöö ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th>
                    <th>üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th>
                    <th>‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td>#{{ order.id }}</td>
                    <td>
                        <ul>
                            {% for item in order.order_items.all %}
                                <li>{{ item.product.name }} x {{ item.quantity }} (‡∏ø{{ item.price_per_item }})</li>
                            {% empty %}
                                <li>‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</li>
                            {% endfor %}
                        </ul>
                    </td>
                    <td class="{% if order.payment_status == 'paid' %}paid{% else %}pending{% endif %}">
                        {{ order.get_payment_status_display }}
                    </td>
                    <td class="status">{{ order.get_status_display }}</td>
                    <td>
                        {{ order.shipping_address }}<br>
                        üìû {{ order.phone_number }}
                    </td>
                    <td>
                        {% if order.status == "processing" %}
                            <button class="ship-order" data-order-id="{{ order.id }}">üì¶ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</button>
                        {% endif %}
                        {% if order.status == "pending" %}
                            <a href="{% url 'update_order_status' order.id 'shipped' %}" class="btn shipped">üöö ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</a>
                        {% elif order.status == "shipped" %}
                            <a href="{% url 'update_order_status' order.id 'delivered' %}" class="btn delivered">‚úÖ ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</a>
                        {% endif %}

                        {% if order.status == "pending" %}
                            <a href="{% url 'cancel_order' order.id %}" class="btn cancel">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </main>
</div>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                document.querySelectorAll(".ship-order").forEach(button => {
                    button.addEventListener("click", function () {
                        let orderId = this.getAttribute("data-order-id");
                        let url = `/seller/orders/${orderId}/ship/`;

                        if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô '‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß'?")) {
                            fetch(url, {
                                method: "GET",
                                headers: { "X-Requested-With": "XMLHttpRequest" }
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    alert(`‚úÖ ${data.message}`);
                                    location.reload();  // ‚úÖ ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                } else {
                                    alert(`‚ùå ${data.message}`);
                                }
                            })
                            .catch(error => console.error("Error:", error));
                        }
                    });
                });
            });
        </script>
